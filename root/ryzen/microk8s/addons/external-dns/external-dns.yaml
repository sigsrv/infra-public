apiVersion: v1
kind: Namespace
metadata:
  name: external-dns
---
apiVersion: helm.cattle.io/v1
kind: HelmChart
metadata:
  name: external-dns
  namespace: helm-charts
spec:
  repo: https://kubernetes-sigs.github.io/external-dns/
  chart: external-dns
  targetNamespace: external-dns
  valuesContent: |-
    provider: cloudflare
    extraArgs:
      - --domain-filter=sigsrv.dev
      - --zone-id-filter=8bae321a816296c96dd3723a2b7e550e
      - --txt-owner-id=external-dns
      - --cloudflare-dns-records-per-page=5000
    env:
    - name: CF_API_TOKEN
      value: "file:///etc/kubernetes/external-dns/CF_API_TOKEN"
    - name: CF_API_EMAIL
      value: "file:///etc/kubernetes/external-dns/CF_API_EMAIL"
    extraVolumeMounts:
    - name: secret-volume
      mountPath: /etc/kubernetes/external-dns
      readOnly: true
    extraVolumes:
    - name: secret-volume
      secret:
        secretName: cloudflare-external-dns
---
apiVersion: v1
kind: Secret
metadata:
  name: cloudflare-external-dns
  namespace: external-dns
type: Opaque
data:
  CF_API_TOKEN: "eHg3bGJFSmpXdUsxQnJVX0w4WXhwWlJpc0RQeHNGZTc0T0FXWlZoYw=="
  CF_API_EMAIL: "ZWNtYXhwQGVjbWF4cC5rcg=="
---
